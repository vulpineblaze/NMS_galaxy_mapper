(function(f,g,e,h){function j(){this._ignore=h;this._debug=!1}function k(a,b){var d=a.split("#")[0],c=b.split("#")[0];return d===c}j.prototype={resume:function(a){this.history();var b=this.target(),d=this.latest(),c=this.route();if(b){this.target(h);if(b!==c)return this._debug&&console.log("Waypoints.resume(): bad link -- target ("+b+") does not match route ("+c+"), redirecting..."),this.redirect(),this;this._debug&&console.log("Waypoints.resume(): good link -- arrived at target("+b+"), bookmarking...");
this.bookmark()}else if(d&&c!==d)return this._debug&&console.log("Waypoints.resume(): bad route -- route("+c+") does not match latest ("+d+"), redirecting..."),this.redirect(),k(d,c)&&a&&a(),this;this._debug&&console.log("Waypoints.resume(): good route -- arrived at route("+c+"), triggering callback...");a&&a();return this},debug:function(a){if(0===arguments.length)return this._debug;this._debug=a;return this},clear:function(){localStorage.removeItem("Waypoints.history");localStorage.removeItem("Waypoints.target");
return this},bookmark:function(){var a=this.route();this._debug&&console.log("Waypoints.bookmark(): bookmarking",a);this.push(a);return this},push:function(a){var b=this.history();b.push(a);5<b.length&&b.shift();this.history(b);return this},history:function(a){if(0===arguments.length){var b=localStorage.getItem("Waypoints.history");return JSON.parse(b)||[]}if(a)return localStorage.setItem("Waypoints.history",JSON.stringify(a)),this;localStorage.removeItem("Waypoints.history");return this},target:function(a){if(0===
arguments.length){var b=localStorage.getItem("Waypoints.target");return JSON.parse(b)}if(a)return localStorage.setItem("Waypoints.target",JSON.stringify(a)),this;localStorage.removeItem("Waypoints.target");return this},ignore:function(a){if(0===arguments.length)return this._ignore;this._ignore=a;return this},route:function(a){if(0===arguments.length)return g.location.href;this.latest()!==a&&(k(a,this.route())?this.push(a):this.target(a));g.location=a;return this},redirect:function(){var a=this.latest();
a&&this.route(a);return this},back:function(){var a=this.history();1<a.length&&(a.pop(),this.history(a),this.redirect());return this},navigate:function(a){var b=e.createElement("a");b.href=a;a=b.href;this._debug&&console.log("Waypoints.navigate(): navigating to",a);this.route(a);return this},open:function(a){this._debug&&console.log("Waypoints.open(): opening safari for",a);var b=e.createElement("a");b.setAttribute("href",a);b.setAttribute("target","_blank");a=e.createEvent("HTMLEvents");a.initEvent("click",
!0,!0);b.dispatchEvent(a)},latest:function(){var a=this.history();return a.length?a[a.length-1]:h},intercept:function(a){var b=this;f(e).on("click",a,function(){return b._onClick(this)});return this},_onClick:function(a){if(f(a).is(this._ignore))return this._debug&&console.log("Waypoints.intercept(): ignoring click"),!0;a=f(a).attr("href");this._debug&&console.log("Waypoints.intercept(): intercepting click with href:",a);this.navigate(a);return!1}};g.Waypoints=new j})(window.jQuery||window.Zepto,
window,document);
